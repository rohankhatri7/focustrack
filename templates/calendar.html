{% extends "base.html" %}
{% block content %}
<div class="page">
  <div class="card calendar-card">
    <div class="calendar-header">
      <a class="cal-nav" href="{{ url_for('calendar', year=prev_year, month=prev_month) }}">‹</a>
      <div class="cal-title">{{ month_name }} {{ year }}</div>
      <a class="cal-nav" href="{{ url_for('calendar', year=next_year, month=next_month) }}">›</a>
    </div>

    <div class="calendar-grid">
      <div class="calendar-day-name">Sun</div>
      <div class="calendar-day-name">Mon</div>
      <div class="calendar-day-name">Tue</div>
      <div class="calendar-day-name">Wed</div>
      <div class="calendar-day-name">Thu</div>
      <div class="calendar-day-name">Fri</div>
      <div class="calendar-day-name">Sat</div>

      {% for week in weeks %}
        {% for day in week %}
          {% if day == 0 %}
            <div class="calendar-cell empty"></div>
          {% else %}
            {% set cell_date = date(year, month, day) %}
            {% set day_tasks = tasks_by_date.get(cell_date, []) %}
            <div class="calendar-cell {% if cell_date == today %}today{% endif %} {% if day_tasks %}has-tasks{% endif %}">
              <div class="calendar-date-number">{{ day }}</div>
              {% for task in day_tasks %}
                <div class="calendar-task
                  {% if task.status == 'Done' %}task-done{% elif task.status == 'In Progress' %}task-inprogress{% else %}task-pending{% endif %}"
                  title="{{ task.title }}{% if task.description %}: {{ task.description }}{% endif %}">
                  <span>{{ task.title }}</span>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
